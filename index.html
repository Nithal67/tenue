<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S√©lecteur de tenue ‚ú®</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@400;500&display=swap');

* { box-sizing: border-box; margin:0; padding:0; }

body {
  font-family: 'Roboto', sans-serif;
  background: #f6f1ed; 
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
  padding: 10px;
}

/* Container de base */
.container {
  border-radius: 20px;
  padding: 20px;
  width: 100%;
  max-width: 650px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.15);
}

/* Typographie */
h1, h2, h3 { font-family: 'Playfair Display', serif; margin-bottom: 20px; }
p { margin-bottom: 20px; }

/* Boutons */
button {
  border: none;
  border-radius: 12px;
  padding: 12px 25px;
  margin: 8px;
  cursor: pointer;
  font-size: 16px;
  width: 100%;
  max-width: 200px;
  transition: all 0.2s ease;
}

button:hover { transform: translateY(-2px); }

/* Masquer les √©crans par d√©faut */
.hidden { display: none !important; }

/* Image grids et preview */
.preview, .image-grid, #tenueJour, #tenueDemain {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
  gap: 10px;
  justify-items: center;
  margin-top: 15px;
  width: 100%;
}

.preview img, .image-grid img {
  width: 100%;
  max-width: 100px;
  aspect-ratio: 1/1;
  object-fit: cover;
  border-radius: 15px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
  cursor: pointer;
  transition: transform 0.2s;
}

.preview img:hover, .image-grid img:hover { transform: scale(1.05); }

/* --- Bouton de suppression sur les images s√©lectionn√©es --- */
.preview div {
  position: relative;
  display: inline-block;
}

.preview button {
  position: absolute;
  top: 4px;
  right: 4px;
  background: rgba(255, 0, 0, 0.8);
  color: white;
  border: none;
  border-radius: 50%;
  width: 22px;
  height: 22px;
  font-size: 14px;
  line-height: 18px;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  z-index: 10;
}

.preview button:hover {
  background: rgba(200, 0, 0, 0.9);
}

/* Top-bar */
.top-bar { text-align: left; margin-bottom: 15px; }

/* Modal */
.modal {
  position: fixed;
  top:0; left:0;
  width:100%; height:100%;
  background-color: rgba(0,0,0,0.6);
  display: none;
  justify-content: center;
  align-items: center;
  padding: 10px;
}

.modal-content {
  border-radius: 20px;
  padding: 20px;
  width: 100%;
  max-width: 500px;
  max-height: 80%;
  overflow-y: auto;
  box-shadow: 0 10px 40px rgba(0,0,0,0.2);
  background: #f9f6f0;
}

.modal-content h3 { color: #4b0082; margin-bottom: 15px; }

/* --- Couleurs sp√©cifiques --- */
#accueil { background: #800020; color: #fff8f0; }
#accueil button { background-color: #f5f0e1; color: #800020; }
#accueil button:hover { background-color: #e0d5c4; }

#cherie { background: #1d4e89; color: #f9f6f0; }
#cherie button { background-color: #4b6cb7; color: #f9f6f0; }
#cherie button:hover { background-color: #3b5590; }

#doudou { background: #4b0082; color: #f9f6f0; }
#doudou button { background-color: #f5f0e1; color: #008080; }
#doudou button:hover { background-color: #005757; }

/* --- Media queries pour mobile --- */
@media screen and (max-width: 480px) {
  .container { padding: 15px; }
  button { font-size: 14px; padding: 10px; max-width: 100%; }
  .preview img, .image-grid img { max-width: 80px; height: auto; }
  .modal-content { max-width: 90%; padding: 15px; }
}
</style>
<!-- ‚úÖ VERSION STABLE EmailJS, sans module -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script>
  (function() {
    emailjs.init("y-NA0J29JT2tMENHP"); // ton public key
  })();
</script>
</head>
<body>

<div id="accueil" class="container">
  <h1>S√©lecteur de tenue ‚ú®</h1>
  <button onclick="choisir('doudou')">Doudou üë®‚Äçüíª</button>
  <button onclick="choisir('cherie')">Ch√©rie üíñ</button>
</div>

<div id="doudou" class="container hidden">
  <div class="top-bar">
    <button onclick="retourAccueil()">‚¨Ö Retour</button>
  </div>
  <h2>Bonjour Doudou üí™</h2>
  <p id="date"></p>
  <div id="selection">
    <button onclick="ouvrirSelection('haut')">üëï Haut</button>
    <button onclick="ouvrirSelection('soutien')">üëô Soutien-gorge</button>
    <button onclick="ouvrirSelection('culotte')">ü©≤ Culotte</button>
    <button onclick="ouvrirSelection('pantalon')">üëñ Pantalon</button>
    <button onclick="ouvrirSelection('chaussettes')">üß¶ Chaussettes</button>
    <button onclick="ouvrirSelection('gilet')">üß• Gilet</button>
    <button onclick="ouvrirSelection('veste')">üß• Veste</button>
  </div>
<button onclick="exporterTenue()">üíæ Exporter tenue du jour</button>
<button onclick="exporterTenue(true)">üåû Exporter tenue de demain</button>
  <div class="preview" id="preview"></div>
</div>

<div id="cherie" class="container hidden">
  <div class="top-bar">
    <button onclick="retourAccueil()">‚¨Ö Retour</button>
  </div>
  <h2>Coucou Ch√©rie üíã</h2>
  <h3>Tenue du jour :</h3>
  <div id="tenueJour"></div>
  <h3>Tenue de demain :</h3>
  <div id="tenueDemain"></div>
  <h3>Linge :</h3>
<button onclick="ouvrirLinge()">üß∫ G√©rer le linge</button>
<div id="lingeContainer"></div>
</div>

<div id="modal" class="modal">
  <div class="modal-content">
    <h3 id="titreSelection"></h3>
    <div class="image-grid" id="imageGrid"></div>
    <button onclick="fermerModal()">Fermer</button>
  </div>
</div>

<script>
const dossierImages = {
  haut: "images/hauts/",
  soutien: "images/soutiens/",
  culotte: "images/culottes/",
  pantalon: "images/pantalons/",
  chaussettes: "images/chaussettes/",
  gilet: "images/gilets/",
  veste: "images/vestes/"
};

const images = {};
let typeEnCours = null;
// STOCK GLOBAL DU LINGE
const linge = {};

function retourAccueil(){
  document.getElementById('doudou').classList.add('hidden');
  document.getElementById('cherie').classList.add('hidden');
  document.getElementById('accueil').classList.remove('hidden');
}

function choisir(personne){
  document.getElementById('accueil').classList.add('hidden');
  if(personne==='doudou'){
    document.getElementById('doudou').classList.remove('hidden');
    document.getElementById('date').textContent = "Nous sommes le " + new Date().toLocaleDateString('fr-FR');
  } else {
    document.getElementById('cherie').classList.remove('hidden');
    chargerTenues();
  }
}

function fermerModal(){ document.getElementById('modal').style.display='none'; }

function ouvrirSelection(type){
  typeEnCours = type;
  const grid = document.getElementById('imageGrid');
  grid.innerHTML = '';

  for(let i=1; i<=5; i++){
    const src = dossierImages[type] + type + i + ".jpg";

    // Si le v√™tement est dans le linge, ne pas l'afficher
    if(Object.values(linge).includes(src)) continue;

    const img = document.createElement('img');
    img.src = src;
    img.style.cursor = 'pointer';
    img.onclick = () => {
      images[type] = src;
      afficherPreview();
      fermerModal();
    };

    grid.appendChild(img);
  }

  document.getElementById('titreSelection').textContent = "Choisir un(e) " + type;
  document.getElementById('modal').style.display = 'flex';
}

function afficherPreview(){
  const preview = document.getElementById('preview');
  preview.innerHTML = '';

  for(const [type, src] of Object.entries(images)){
    const container = document.createElement('div');
    container.style.position = 'relative';
    container.style.display = 'inline-block';

    const img = document.createElement('img');
    img.src = src;
    img.alt = type;
    img.style.margin = '5px';
    img.style.width = '100px';
    img.style.height = 'auto';
    img.style.objectFit = 'cover';
    img.style.borderRadius = '10px';

    // bouton supprimer
    const btn = document.createElement('button');
    btn.textContent = '‚úñ';
    btn.style.position = 'absolute';
    btn.style.top = '0';
    btn.style.right = '0';
    btn.style.background = 'rgba(255,0,0,0.7)';
    btn.style.color = 'white';
    btn.style.border = 'none';
    btn.style.borderRadius = '50%';
    btn.style.width = '20px';
    btn.style.height = '20px';
    btn.style.cursor = 'pointer';
    btn.onclick = () => { delete images[type]; afficherPreview(); };

    container.appendChild(img);
    container.appendChild(btn);
    preview.appendChild(container);
  }
}

function exporterTenue(pourDemain=false){
  const dateObj = new Date();
  const filename = pourDemain ? 'tenue_demain.json' : 'tenue_aujourdhui.json';

  if(pourDemain) dateObj.setDate(dateObj.getDate()+1);
  const date = dateObj.toISOString().slice(0,10); // YYYY-MM-DD

  const data = {};
  data[date] = { cherie: images }; // ou doudou selon ton choix

  const json = JSON.stringify(data, null, 2);

  const blob = new Blob([json], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.click();
  URL.revokeObjectURL(url);

  alert(`üíæ Tenue ${pourDemain ? 'de demain' : 'du jour'} export√©e !`);
}

function chargerTenues(){
  // Tenue d'aujourd'hui
  fetch('tenue_aujourdhui.json')
    .then(res => res.json())
    .then(data => {
      afficherTenueData(data, 'tenueJour');
    })
    .catch(err => console.warn("Aucune tenue du jour :", err));

  // Tenue de demain
  fetch('tenue_demain.json')
    .then(res => res.json())
    .then(data => {
      afficherTenueData(data, 'tenueDemain');
    })
    .catch(err => console.warn("Aucune tenue de demain :", err));
}

function afficherTenueData(data, id){
  const div = document.getElementById(id);
  div.innerHTML = '';

  const dateKey = Object.keys(data)[0]; // prendre la premi√®re date
  const tenue = data[dateKey]?.cherie;

  if(!tenue){
    div.innerHTML = '<p>Aucune tenue enregistr√©e.</p>';
    return;
  }

  for(const [type, srcs] of Object.entries(tenue)){
    if(Array.isArray(srcs)){
      srcs.forEach(src => {
        const img = document.createElement('img');
        img.src = src;
        img.style.width = "100%";
        img.style.maxWidth = "100px";
        img.style.height = "auto";
        img.style.objectFit = "cover";
        div.appendChild(img);
      });
    } else {
      const img = document.createElement('img');
      img.src = srcs;
      img.style.width = "100%";
      img.style.maxWidth = "100px";
      img.style.height = "auto";
      img.style.objectFit = "cover";
      div.appendChild(img);
    }
  }
}

function ouvrirLinge() {
  const grid = document.getElementById('imageGrid');
  grid.innerHTML = '';

  // Parcourir tous les types d'habits
  for (const type of Object.keys(dossierImages)) {
    for (let i = 1; i <= 5; i++) {
      const src = dossierImages[type] + type + i + ".jpg";

      const container = document.createElement('div');
      const img = document.createElement('img');
      img.src = src;
      img.style.width = '80px';
      img.style.height = '80px';
      img.style.objectFit = 'cover';
      img.style.borderRadius = '10px';
      img.style.opacity = linge[src] ? 0.4 : 1;

      // üëá G√®re l'ajout/retrait, mais n'envoie pas d'email imm√©diatement
      img.onclick = () => g√©rerClicLinge(src, img);

      container.appendChild(img);
      grid.appendChild(container);
    }
  }

  document.getElementById('titreSelection').textContent = 'üß∫ G√©rer le linge';
  document.getElementById('modal').style.display = 'flex';
}
  
function afficherLinge(){
  const div = document.getElementById('lingeContainer');
  div.innerHTML = '';
  for(const src of Object.values(linge)){
    const img = document.createElement('img');
    img.src = src;
    img.style.width = '80px';
    img.style.height = '80px';
    img.style.objectFit = 'cover';
    img.style.margin = '5px';
    img.style.opacity = 0.6;
    div.appendChild(img);
  }
}

// tableau pour accumuler les actions
let actionsLinge = [];

function g√©rerClicLinge(src, img) {
  const estDansLinge = !!linge[src];
  if (estDansLinge) {
    delete linge[src];
    img.style.opacity = 1;
    actionsLinge.push(`‚ùå Retir√© du linge : ${src}`);
  } else {
    linge[src] = src;
    img.style.opacity = 0.4;
    actionsLinge.push(`‚úÖ Ajout√© au linge : ${src}`);
  }
  afficherLinge();
}

function fermerModal() {
  document.getElementById('modal').style.display = 'none';

  if (actionsLinge.length > 0) {
    const message = actionsLinge.join("\n");
    envoyerEmail(message);
    actionsLinge = []; // vider le tableau apr√®s envoi
  }
}

// fonction envoyerEmail inchang√©e
function envoyerEmail(message) {
  emailjs.send("service_uz0clti", "template_rjrwj6k", {
    action: message
  })
  .then(() => console.log("‚úÖ Email envoy√© :", message))
  .catch(err => console.error("‚ùå Erreur Email :", err));
}
</script>
</body>
</html>
